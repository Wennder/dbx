<?php
require_once('credentials.php');
require_once('classes/helper/Dbhelper.php');
require_once ('classes/other/geshi/geshi.php');


require_once('classes/Exploit.php');
require_once('classes/pExploit.php');
require ('classes/Platform.php');
require ('classes/pPlatform.php');

require_once 'classes/Category.php';
require_once 'classes/pCategory.php';
/**Passwörter*/
require_once 'classes/other/phpass-0.3/PasswordHash.php';
require_once 'classes/helper/Login.php';
require_once 'classes/helper/Session.php';
require_once 'classes/helper/Upload.php';
require_once 'classes/helper/Getvars.php';
require_once 'classes/helper/Formgen.php';

$dbh=new PDO(DB_DSN, DB_USR, DB_PASS);
$dbh->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_WARNING);		//@todo das steht nur zum üben hier

$e=new pExploit();

$e->dbh($dbh);
$exploits=$e->mysqlSelect();
$fgen=new Formgen();
?>

<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>list exploit</title>
<link rel="stylesheet" media="all" href="layout.css">
<script>function confirmGo(m,u) {
	if ( confirm(m) ) {
		window.location = u;
		}
		}
		
</script>
</head>
<body>
	<div id="head">
		<h1>list exploits</h1>
		 <img src="img/logo.png" alt="logo" /> 
	</div>
	<div>
	
	
	<div class="list">
	<table class="exploits-list">
	<?php
	
	
//LOESCHEN
$getDelete=new Getvars();
$getDelete->requireVar('delete');
if ($getDelete->validateVars()){
	$exploit=new pExploit();
	$exploit->dbh($dbh);
	$exploit->id($getDelete->delete());
	$exploit->mysqlDelete();
	
}

	

foreach ($exploits as  $e){
		$view=$fgen->getLink($e->title(), 'ShowExploit.php', array("view" =>$e->id() ));
		$edit=$fgen->getLink('edit', 'ListExploit.php', array("edit" =>$e->id() ) );	
		$delete=$fgen->getLink('delete', 'ListExploit.php',array('delete'=>$e->id()),true, "{$e->title()} löschen?");
	echo "<tr><td>$view</td><td>$edit</td><td>$delete</td></tr>\n";
}

?>
</table>
</div>
	</div>
</body>
</html>