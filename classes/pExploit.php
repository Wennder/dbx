<?php
class pExploit extends Exploit{
	public function mysqlSelect($id=""){
		if(!$this->dbh())
		return false;
		if (empty($id)){
			$sql="SELECT * FROM cms_exploit";
			$stmt=$this->dbh->prepare($sql);
			$stmt->execute();
			$exploits=array();
				
				
			foreach($stmt->fetchAll() as $value){
				$e=new pExploit();
				$e->id($value['id']);
				$e->date=$value['date'];
				$e->verified=$value['verified'];
				$e->hits=$value['hits'];
				$e->autor=$value['autor'];
				$e->codeLanguage=$value['code_language'];
				$e->title=$value['title'];
				$e->content=$value['content'];
				$e->file=$value['file'];
				$e->category=$value['category'];
				$e->platform=$value['platform'];
				$e->dbh=$e->dbh();
				$exploits[]=$e;
			}
			return $exploits;
		} else {
			$sql="SELECT * FROM cms_exploit WHERE id=?";
			$stmt=$this->dbh->prepare($sql);
			$stmt->bindParam(1, $id, PDO::PARAM_INT);
			$stmt->execute();
			
			$value=$stmt->fetch(PDO::FETCH_ASSOC);			
			if($value==null)
				return false;
			$this->id($value['id']);
			$this->date=$value['date'];
			$this->verified=$value['verified'];
			$this->hits=$value['hits'];
			$this->autor=$value['autor'];
			$this->codeLanguage=$value['code_language'];
			$this->title=$value['title'];
			$this->content=$value['content'];
			$this->file=$value['file'];
			$this->category=$value['category'];
			$this->platform=$value['platform'];
		}
	}//function
	
	public function mysqlInsert(){
	$sql="INSERT INTO `exploit`.`cms_exploit` (			
				`verified` ,
				`hits` ,
				`autor` ,
				`code_language` ,
				`title` ,
				`content` ,
				`file` ,
				`category` ,
				`platform`
				)
				VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?);";
		$stmt=$this->dbh->prepare($sql);
		$stmt->bindParam(1, $this->verified(), PDO::PARAM_BOOL);
		$stmt->bindParam(2, $this->hits , PDO::PARAM_INT);
		$stmt->bindParam(3, $this->autor , PDO::PARAM_STR);
		$stmt->bindParam(4, $this->codeLanguage , PDO::PARAM_STR);
		$stmt->bindParam(5, $this->title , PDO::PARAM_STR);
		$stmt->bindParam(6, $this->content , PDO::PARAM_STR);
		$stmt->bindParam(7, $this->file, PDO::PARAM_STR);
		$stmt->bindParam(8, $this->category , PDO::PARAM_STR);
		$stmt->bindParam(9, $this->platform, PDO::PARAM_STR);
			
		$stmt->execute();
	}
	public function mysqlUpdate(){
		$sql="UPDATE `exploit`.`cms_exploit` SET 
			`date` = 'CURRENT_TIMESTAMP',
			`verified` = '?',
			`hits` = '?',
			`autor` = '?',
			`code_language` = '?',
			`title` = '?',
			`content` = '?',
			`category` = '?',
			`platform` = '?' 
			WHERE `cms_exploit`.`id` =?";
		$stmt=$this->dbh->prepare($sql);
		#$stmt->bindParam(1, $this->date() , PDO::PARAM_INT);
		$stmt->bindParam(1, $this->verified(), PDO::PARAM_BOOL);
		$stmt->bindParam(2, $this->hits , PDO::PARAM_INT);
		$stmt->bindParam(3, $this->autor , PDO::PARAM_STR);
		$stmt->bindParam(4, $this->codeLanguage , PDO::PARAM_STR);
		$stmt->bindParam(5, $this->title , PDO::PARAM_STR);
		$stmt->bindParam(6, $this->content , PDO::PARAM_STR);
		$stmt->bindParam(7, $this->category , PDO::PARAM_INT);
		$stmt->bindParam(8, $this->platform, PDO::PARAM_INT);
		$stmt->bindParam(9, $this->file, PDO::PARAM_STR);
		$stmt->bindParam(10, $this->id , PDO::PARAM_INT);
		$stmt->execute();
		
		
		
	}
	
	public function loadCategory(){
		if ($this->dbh){
				$c=new pCategory();
				$c->dbh($this->dbh());
				$c->mysqlSelect($this->category());
				return $c->name();
			
		}						
	}
	public function loadPlatform(){
		if ($this->dbh){
			$p=new pPlatform();
			$p->dbh($this->dbh());
			$p->mysqlSelect($this->platform);
			return $p->name();
		}
		
		
	}
}//class